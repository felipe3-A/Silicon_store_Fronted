<div class="container my-5">
  <div class="row justify-content-center">
    <!-- Columna Izquierda: Galería de Imágenes -->
    <div class="col-md-5">
      <div class="card shadow-sm p-3 mb-4" style="border-radius: 1rem;">
        <div class="main-image-container text-center" (click)="abrirLightbox()">
          <img [src]="imagenPrincipal || 'https://via.placeholder.com/400x300'" 
               alt="Imagen del producto" 
               class="main-image img-fluid rounded" />
        </div>

        <!-- Miniaturas -->
        <div class="d-flex justify-content-center flex-wrap mt-3">
          <ng-container *ngIf="galeriaImagenes?.length > 0">
            <div *ngFor="let imagen of galeriaImagenes; let i = index" class="m-1">
              <img [src]="imagen || 'http://localhost:8000/storage/' + imagen" 
                   [ngClass]="{'selected': imagenPrincipal === imagen}" 
                   class="thumbnail-image img-thumbnail" 
                   alt="Miniatura" 
                   (click)="cambiarImagenPrincipal(i)" />
            </div>
          </ng-container>
        </div>
      </div>
    </div>

    <!-- Columna Derecha: Información del Producto -->
    <div class="col-md-7">
      <div class="card shadow-sm p-4" style="border-radius: 1rem;">
        <h1 class="h4 mb-3 fw-bold">{{ itemSeleccionado.name }}</h1>

        <p class="text-muted mb-2">
          <strong>Categoría:</strong> {{ itemSeleccionado.category }}
        </p>

        <h2 class="h3 text-danger mb-3">
          ${{ itemSeleccionado.unit_price | number:'1.0-0' }}
        </h2>

        <p class="mb-3">
          <strong>Unidades disponibles:</strong> {{ itemSeleccionado.total_quantity }}
        </p>

        <hr>

        <div class="mb-3">
          <h5 class="fw-semibold">Descripción</h5>
          <p class="text-muted" style="white-space: pre-line;">
            {{ itemSeleccionado.description }}
          </p>
        </div>

        <!-- Botones de Acción -->
        <div class="d-grid gap-2">
          <button class="btn btn-success btn-lg d-flex align-items-center justify-content-center"
            [disabled]="itemSeleccionado.total_quantity <= 0"
            (click)="agregarAlCarrito(itemSeleccionado)">
            <i class="bi bi-cart-plus me-2"></i> Agregar al carrito
          </button>

          <button class="btn btn-outline-danger btn-lg d-flex align-items-center justify-content-center">
            <i class="bi bi-heart me-2"></i> Agregar a favoritos
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Lightbox (vista ampliada) -->
  <div *ngIf="mostrarLightbox" class="lightbox-overlay">
    <div class="lightbox-content">
      <button class="close-btn" (click)="cerrarLightbox()">×</button>
      <button class="nav-btn prev" (click)="imagenAnterior()">&#10094;</button>
      <img [src]="galeriaImagenes[imagenActualIndex]" alt="Imagen ampliada" class="lightbox-image" />
      <button class="nav-btn next" (click)="imagenSiguiente()">&#10095;</button>
    </div>
  </div>

  <!-- Modal para zoom -->
  <div *ngIf="mostrarZoom" class="zoom-overlay" (click)="cerrarZoom()">
    <img [src]="imagenPrincipal" alt="Imagen ampliada" class="zoom-image" />
  </div>
</div>


<div class="fila3">
  <h3 class="text-center mb-4">Productos Disponibles</h3>

  <div class="row">
    <div class="col-md-3 mb-4" *ngFor="let producto of productos">
      <div class="card_product border shadow-sm rounded-3 p-3 text-center" (click)="verProducto(producto.item_id)" style="cursor: pointer;">
        <img [src]="producto.imagen" class="card-img-top img-fluid imagen-producto" alt="Imagen del producto">
        <h6 class="card-title_2 mt-3">{{ producto.name }}</h6>
        <div class="mt-1">
          <span *ngIf="producto.total_quantity === 1" class="badge bg-danger">¡Producto limitado!</span>
          <span *ngIf="producto.total_quantity === 0" class="badge bg-warning">¡Sin stock!</span>
          <span *ngIf="producto.total_quantity > 1" class="badge bg-success">Disponible</span>
        </div>
        <div class="d-flex justify-content-center mt-3 gap-2">
          <button class="btn btn-success btn-sm" (click)="agregarAlCarrito(producto)">
            <i class="bi bi-cart-plus"></i>
          </button>
          <button class="btn btn-info btn-sm" (click)="verProducto(producto.item_id)">
            <i class="bi bi-info-circle"></i>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Vista lateral del producto seleccionado -->
  <div *ngIf="itemSeleccionado" class="card mt-5 p-4 shadow-lg">
    <div class="row">
      <div class="col-md-6">
        <h4>{{ itemSeleccionado.name }}</h4>
        <p><strong>Descripción:</strong> {{ itemSeleccionado.description || 'Sin descripción' }}</p>
        <p><strong>Precio:</strong> ${{ itemSeleccionado.price || 'N/A' }}</p>
        <p>
          <strong>Stock:</strong> 
          <span *ngIf="itemSeleccionado.total_quantity > 0" class="text-success">Disponible</span>
          <span *ngIf="itemSeleccionado.total_quantity == 0" class="text-danger">Agotado</span>
        </p>
        <button class="btn btn-primary mt-2" (click)="agregarAlCarrito(itemSeleccionado)">Agregar al Carrito</button>
      </div>

      <div class="col-md-6">
        <div class="gallery">
          <img [src]="imagenPrincipal" class="img-fluid mb-3 border rounded" style="max-height: 300px; object-fit: cover;">
          <div class="d-flex gap-2 flex-wrap">
            <img *ngFor="let img of galeriaImagenes; let i = index"
                 [src]="img"
                 (click)="cambiarImagenPrincipal(i)"
                 class="img-thumbnail"
                 style="width: 80px; height: 80px; object-fit: cover; cursor: pointer;">
          </div>
        </div>
      </div>
    </div>
  </div>

</div>


<!-- Panel lateral de Detalles de Producto -->
<div class="producto-info-sidebar" [class.abierto]="mostrarDetalle">
  <div class="contenido-sidebar p-4">
    <button class="btn btn-danger mb-4" (click)="cerrarDetalles()">Cerrar</button>

    <div *ngIf="productoSeleccionado">
      <h3 class="fw-bold">{{ productoSeleccionado.name }}</h3>
      <img [src]="productoSeleccionado.imagen" class="img-fluid rounded mb-3" alt="Producto" style="max-height: 250px; object-fit: contain;">
      <p><strong>Descripción:</strong> {{ productoSeleccionado.description || 'Sin descripción.' }}</p>
      <p><strong>Precio:</strong> {{ productoSeleccionado.price | currency }}</p>
      <p><strong>Stock disponible:</strong> {{ productoSeleccionado.total_quantity }}</p>

      <button class="btn btn-success w-100 mt-3" (click)="agregarAlCarrito(productoSeleccionado)">Agregar al carrito</button>
    </div>
  </div>
</div>
